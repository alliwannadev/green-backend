-- 테이블 생성
CREATE TABLE IF NOT EXISTS USER (
    USER_ID BIGINT NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL,
    PHONE VARCHAR(20) NOT NULL,
    NAME VARCHAR(50) NOT NULL,

    IMAGE_URL VARCHAR(255),
    ROLES VARCHAR(100),
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (USER_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS OUTBOX (
    OUTBOX_ID BIGINT NOT NULL,
    SHARD_KEY BIGINT,
    PAYLOAD TEXT NOT NULL,
    EVENT_TYPE VARCHAR(50) NOT NULL,
    CREATED_AT DATETIME,
    PRIMARY KEY (OUTBOX_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS COUPON_POLICY (
    COUPON_POLICY_ID BIGINT NOT NULL,
    COUPON_NAME VARCHAR(100) NOT NULL,
    DESCRIPTION VARCHAR(255) NOT NULL,
    DISCOUNT_TYPE VARCHAR(50) NOT NULL,
    DISCOUNT_VALUE INT NOT NULL,
    TOTAL_QUANTITY INT,
    MINIMUM_ORDER_AMOUNT INT,
    MAXIMUM_DISCOUNT_AMOUNT INT,
    START_ISSUE_DATE DATETIME NOT NULL,
    END_ISSUE_DATE DATETIME NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME NOT NULL,
    PRIMARY KEY (COUPON_POLICY_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS COUPON (
    COUPON_ID BIGINT NOT NULL,
    COUPON_POLICY_ID BIGINT,
    USER_ID BIGINT,
    ORDER_ID BIGINT,
    COUPON_CODE VARCHAR(50),
    COUPON_STATUS VARCHAR(20),
    USED_AT DATETIME,
    CREATED_AT DATETIME,
    PRIMARY KEY (COUPON_ID)
) ENGINE=INNODB;

-- 인덱스 생성
CREATE INDEX IDX__USER__PHONE ON USER(PHONE);

-- 초기 데이터 입력
INSERT INTO COUPON_POLICY (
    COUPON_POLICY_ID, COUPON_NAME, DESCRIPTION, DISCOUNT_TYPE, DISCOUNT_VALUE,
    TOTAL_QUANTITY, MINIMUM_ORDER_AMOUNT, MAXIMUM_DISCOUNT_AMOUNT, START_ISSUE_DATE,
    END_ISSUE_DATE, CREATED_AT, UPDATED_AT
)
VALUES (
    1564585756856320, 'WELCOME COUPON', '웰컴 쿠폰', 'PERCENTAGE', 20,
    NULL, NULL, NULL, NOW(), '9999-12-31 23:59:59',
    NOW(), NOW()
);
