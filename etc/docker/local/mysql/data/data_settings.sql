-- 테이블 생성
CREATE TABLE IF NOT EXISTS USER (
    USER_ID BIGINT NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL,
    PHONE VARCHAR(20) NOT NULL,
    NAME VARCHAR(50) NOT NULL,
    IMAGE_URL VARCHAR(255),
    ROLES VARCHAR(100),
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (USER_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS OUTBOX (
    OUTBOX_ID BIGINT NOT NULL,
    SHARD_KEY BIGINT,
    PAYLOAD TEXT NOT NULL,
    EVENT_TYPE VARCHAR(50) NOT NULL,
    CREATED_AT DATETIME,
    PRIMARY KEY (OUTBOX_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS COUPON_POLICY (
    COUPON_POLICY_ID BIGINT NOT NULL,
    COUPON_NAME VARCHAR(100) NOT NULL,
    DESCRIPTION VARCHAR(255) NOT NULL,
    DISCOUNT_TYPE VARCHAR(50) NOT NULL,
    DISCOUNT_VALUE INT NOT NULL,
    TOTAL_QUANTITY INT,
    MINIMUM_ORDER_AMOUNT INT,
    MAXIMUM_DISCOUNT_AMOUNT INT,
    START_ISSUE_DATE DATETIME NOT NULL,
    END_ISSUE_DATE DATETIME NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME NOT NULL,
    PRIMARY KEY (COUPON_POLICY_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS COUPON (
    COUPON_ID BIGINT NOT NULL,
    COUPON_POLICY_ID BIGINT,
    USER_ID BIGINT,
    ORDER_ID BIGINT,
    COUPON_CODE VARCHAR(50),
    COUPON_STATUS VARCHAR(20),
    USED_AT DATETIME,
    CREATED_AT DATETIME,
    PRIMARY KEY (COUPON_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS PRODUCT (
    PRODUCT_ID BIGINT NOT NULL,
    PRODUCT_CODE VARCHAR(255),
    PRODUCT_NAME VARCHAR(255),
    MODEL_NAME VARCHAR(255),
    ORIGINAL_PRICE BIGINT,
    SELLING_PRICE BIGINT,
    DESCRIPTION VARCHAR(255),
    IS_DISPLAYED BOOL,
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (PRODUCT_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS PRODUCT_OPTION (
    PRODUCT_OPTION_ID BIGINT NOT NULL,
    PRODUCT_ID BIGINT NOT NULL,
    OPTION_CODE VARCHAR(255),
    OPTION_NAME VARCHAR(255),
    OPTION_VALUE VARCHAR(255),
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (PRODUCT_OPTION_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS PRODUCT_OPTION_COMBINATION (
    PRODUCT_OPTION_COMBINATION_ID BIGINT NOT NULL,
    PRODUCT_ID BIGINT NOT NULL,
    SELECTED_OPTIONS VARCHAR(255),
    COMBINATION_CODE VARCHAR(255),
    UNIQUE_COMBINATION_CODE VARCHAR(255),
    OPTION_MANAGEMENT_CODE VARCHAR(255),
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (PRODUCT_OPTION_COMBINATION_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS CART (
    CART_ID BIGINT NOT NULL,
    USER_ID BIGINT,
    TOTAL_QUANTITY BIGINT,
    TOTAL_AMOUNT BIGINT,
    TOTAL_DISCOUNTED_AMOUNT BIGINT,
    TOTAL_PAYMENT_AMOUNT BIGINT,
    PRIMARY KEY (CART_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS CART_ITEM (
    CART_ITEM_ID BIGINT NOT NULL,
    CART_ID BIGINT,
    PRODUCT_ID BIGINT,
    PRODUCT_NAME VARCHAR(100),
    PRODUCT_OPTION_COMBINATION_ID BIGINT,
    SELECTED_OPTIONS VARCHAR(255),
    THUMBNAIL_URL VARCHAR(255),
    PRICE BIGINT,
    QUANTITY BIGINT,
    AMOUNT BIGINT,
    DISCOUNTED_AMOUNT BIGINT,
    PAYMENT_AMOUNT BIGINT,
    PRIMARY KEY (CART_ITEM_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS ORDERS (
    ORDER_ID BIGINT NOT NULL,
    USER_ID BIGINT,
    ORDER_NO VARCHAR(100),
    ORDER_STATUS VARCHAR(10),
    RECEIVER_NAME VARCHAR(50),
    RECEIVER_PHONE_NUMBER VARCHAR(20),
    RECEIVER_ADDR VARCHAR(100),
    RECEIVER_POSTAL_CODE VARCHAR(10),
    TOTAL_QUANTITY BIGINT,
    TOTAL_AMOUNT BIGINT,
    TOTAL_DISCOUNTED_AMOUNT BIGINT,
    TOTAL_PAYMENT_AMOUNT BIGINT,
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (ORDER_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS ORDER_ITEM (
    ORDER_ITEM_ID BIGINT NOT NULL,
    ORDER_ID BIGINT,
    PRODUCT_ID BIGINT,
    PRODUCT_OPTION_COMBINATION_ID BIGINT,
    PRICE BIGINT,
    DISCOUNTED_PRICE BIGINT,
    PAYMENT_PRICE BIGINT,
    QUANTITY BIGINT,
    AMOUNT BIGINT,
    DISCOUNTED_AMOUNT BIGINT,
    PAYMENT_AMOUNT BIGINT,
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (ORDER_ITEM_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS PRODUCT_WAREHOUSING (
    WAREHOUSING_ID BIGINT NOT NULL,
    STOCK_ID BIGINT,
    WAREHOUSING_DATE DATE,
    PRODUCT_OPTION_COMBINATION_ID BIGINT,
    QUANTITY BIGINT,
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (WAREHOUSING_ID)
) ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS STOCK (
    STOCK_ID BIGINT NOT NULL,
    PRODUCT_OPTION_COMBINATION_ID BIGINT,
    QUANTITY BIGINT,
    CREATED_AT DATETIME,
    UPDATED_AT DATETIME,
    PRIMARY KEY (STOCK_ID)
) ENGINE=INNODB;

-- 인덱스 생성
CREATE UNIQUE INDEX UQ__USER__EMAIL ON USER(EMAIL);
CREATE INDEX IDX__USER__EMAIL ON USER(PHONE);

CREATE FULLTEXT INDEX FT__PRODUCT_OPTION_COMBINATION__SELECTED_OPTIONS ON PRODUCT_OPTION_COMBINATION (SELECTED_OPTIONS) WITH PARSER ngram;
CREATE INDEX IDX__PRODUCT_OPTION_COMBINATION__PRODUCT_ID ON PRODUCT_OPTION_COMBINATION(PRODUCT_ID);

-- 초기 데이터 입력
INSERT INTO COUPON_POLICY (
    COUPON_POLICY_ID, COUPON_NAME, DESCRIPTION, DISCOUNT_TYPE, DISCOUNT_VALUE,
    TOTAL_QUANTITY, MINIMUM_ORDER_AMOUNT, MAXIMUM_DISCOUNT_AMOUNT, START_ISSUE_DATE,
    END_ISSUE_DATE, CREATED_AT, UPDATED_AT
)
VALUES (
    1564585756856320, 'WELCOME COUPON', '웰컴 쿠폰', 'PERCENTAGE', 20,
    NULL, NULL, NULL, NOW(), '9999-12-31 23:59:59',
    NOW(), NOW()
);
